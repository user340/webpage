<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<title>e-yuuki.org</title>
</head>
<body><div class="tiny">
<h1>デスクトップ環境の作り方</h1>
<hr>
<h2>なぜ作り方を知っておくと良いのか</h2>
<p>雑な言い方をしてしまえば、GNOMEやKDEまたはXfce4のような統合デスクトップ環境を使うのが一番手っ取り早いし機能も豊富だと思われます。一方でこれらの「てんこ盛り」な環境をインストールしても、たいしてUnixの訓練にはなりません。なぜならインストール方法や使い方が簡単すぎて特にこれといって知識やノウハウを習得できないからです（当然、使い方が簡単すぎるというのは技術やUIの偉大な進歩の結果であります）。</p>

<p>日常生活で使うに耐えうるデスクトップ環境を作る方法を学ぶには、統合デスクトップ環境をインストールするよりも、ひとつひとつパッケージをインストールして設定する他ありません。また稀なケースとして、マシンスペックがあまりにも低すぎてXfce4ですらまともに動かないケースも無くはないでしょう。そのような事態に直面したとき、統合デスクトップ環境以外を知らなければ話になりません。</p>

<p>ある程度デスクトップ環境の作り方を把握し、デスクトップ環境の要素を抑えておけばいざというときに役に立ちます。そのいざというときは前述したような極限環境下で作業せざるを得ないときかもしれませんし、最小構成でインストールされたGNU/Linuxの上でデスクトップ環境を作りたくなったときとか、そもそもインストーラがデスクトップ環境を提供していないOSを使うときかもしれません。</p>

<h2>GUI環境に必要なソフトウェア</h2>
<p>「デスクトップ環境」になにが必要であるかはユーザに強く依存します。Webブラウザさえあれば十分というユーザもいれば、動画編集ソフトウェアが不可欠なユーザも考えられます。様々なニーズをすべて包括したデスクトップ環境を用意するのは難しいので、ここではマウスを使ってウィンドウを自在に動かせられるグラフィカルな環境（GUI）を用意するには、なにをどのようにインストールすればいいのかのみ説明する。</p>

<h3>NetBSDのX</h3>
<p>NetBSDではGUI環境のために"X11"と呼ばれるソフトウェアを使います。FreeBSDと違いNetBSD 8.0ではベースシステムでX11が提供されています。以下のtarballをインストール時に選択するか、FTPサーバからダウンロードしてルートディレクトリに展開してください。</p>

<ul>
<li>xbase.tgz</li>
<li>xetc.tgz</li>
<li>xfont.tgz</li>
<li>xserver.tgz</li>
</ul>

<p>X11はサーバとクライアントが分離しており、Xサーバが動くマシン上でXクライアントのソフトウェア（FirefoxやThunderbirdなど）が描画されるシステムになっています。ここではクライアントとサーバ両方をインストールしていることになります。デスクトップ用途ではX11のサーバ・クライアントモデルを特別に意識することはありません。</p>

<h3>/etc/X11/xorg.conf</h3>
<p><code>xorg.conf(5)</code>はXサーバの設定ファイルです。</p>

<p>もっとも、これをゼロから書くわけではありません。ユーザは<code>xorg.conf(5)</code>を自動で生成する<code>Xorg(1)</code>の<code>-configure</code>オプションを実行して、必要なときだけ設定ファイルを編集します。ディスプレイの拡張やマウスの設定を細かくしたいときに初めてエディタで開くことになるでしょう。</p>

<p>このコマンドを実行するとrootユーザのホームディレクトリにxorg.conf.newというファイルが作られます。それを/etc/X11ディレクトリの下に移動させます。</p>

<pre><code># X -configure
# mv /root/xorg.conf.new /etc/X11/xorg.conf</code></pre>

<h3>ウィンドウマネージャ</h3>

<figure>
<blockquote><p>Xでは、このウィンドウの外見や操作性を提供しているのは<b>ウィンドウマネージャ</b>というプログラムです。デフォルトでは、TWMというウィンドウマネージャが動作しています。これをほかのものに変更したりカスタマイズしたりすることで、見違えるようなデスクトップ環境を作り出すことができます。なお、ここでいう「デスクトップ環境」とはウィンドウマネージャ単体ではなく、共通した外観や操作性を持ったアプリケーション群一体を指します。</p></blockquote>
<footer>&mdash; <cite>FreeBSD徹底入門［改訂版］</cite>, p296</footer>
</figure>

<p>ウィンドウマネージャは数え切れないほど多くの実装がありすべてを紹介するのは不可能です。本ページでは"i3"というタイル型ウィンドウマネージャをおすすめしますが、これは操作方法を覚えるのに少し時間がかかります。多くの人にとっては"JWM"や"Window Maker"といったスタック型ウィンドウマネージャが扱いやすいでしょう。ウィンドウマネージャのパッケージをひとつずつ試していって好みのものを模索してください。</p>

<h3>$HOME/.xinitrc</h3>

<p><code>xinitrc</code>は<code>xinit(1)</code>が読み込むスクリプトです。<code>xinit(1)</code>はXサーバを動かし、<code>xinitrc</code>で指定されているクライアントプログラムを実行します。これは各ユーザのホームディレクトリに隠しファイルとして置いておきます。<code>xinitrc</code>の内容はユーザがなにを使いたいかによって左右されるので、クライアントソフトウェアの解説をするとき設定方法のいち手順として<code>xinitrc</code>になにを書くべきか説明されるのが一般的です。</p>

<p>たとえば僕が普段使っているデスクトップ環境の<code>$HOME/.xinitrc</code>は次の通りです。</p>

<pre><code>#!/bin/sh

# Language
export LANG="ja_JP.UTF-8"

# Font
xset fp+ /usr/pkg/share/fonts/X11/TTF/

# No bell
xset b off

# Keybord layout
setxkbmap -model us -layout us -option ctrl:nocaps

# For inputmethod/ibus-mozc
export XMODIFIERS="@im=ibus"
export GTK_IM_MODULE="ibus"
export QT_IM_MODULE="ibus"
export DefaultIMModule="ibus"

# For i3-dmenu-desktop
export XDG_DATA_DIRS="/usr/pkg/share:$XDG_DATA_DIRS"

xmodmap $HOME/.Xmodmap
/usr/pkg/bin/ibus-daemon -drx
/usr/pkg/bin/i3</code></pre>

<h2>まとめ</h2>

<p>グラフィカルな環境を用意するには最低限以下のものを用意します。</p>

<ul>
  <li>X11</li>
  <li>ウィンドウマネージャ</li>
  <li><code>$HOME/.xinitrc</code></li>
</ul>

<p>あとは必要に応じてソフトウェアをインストールし<code>xinitrc</code>を編集すればいいわけです。</p>
<hr>
<footer>
<div style="text-align:center;padding-top:2em;padding-bottom:2em;"><a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/"><img src="https://i.creativecommons.org/p/zero/1.0/88x31.png" alt="CC0" /></a></div>
<p>To the extent possible under law, <a href="mailto:uki@e-yuuki.org">Yuuki Enomoto</a> has waived all copyright and related or neighboring rights to e-yuuki.org. This work is published from: Japan.</p>
</footer>
</div></body>
</html>
